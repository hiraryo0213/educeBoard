!function(t){var a="educeboardDataLoad",n=t("body"),e={initialize:function(n){return this.each(function(){t(this).data(a,t.extend(!0,{courseURL:"http://pb.fm.senshu-u.ac.jp/~tmochi/educeboard/loginCourseList.php",userURL:"http://pb.fm.senshu-u.ac.jp/~tmochi/educeboard/loginCourseMemberList.php",authURL:"http://pb.fm.senshu-u.ac.jp/~tmochi/educeboard/loginAuth.php",simulationURL:"http://pb.fm.senshu-u.ac.jp/~tmochi/educeboard/showSessionList.php",commentURL:"http://pb.fm.senshu-u.ac.jp/~tmochi/educeboard/showComments.php",courseButtonText:null,userButtonText:null,basicInfoObj:{cid:null,uid:null,uname:null,simid:null,sid:null,tid:null},courseParameter:{xml:1},userParameter:{xml:1,cid:null},authParameter:{xml:1,uid:null,pwd:null},commentParameter:{xml:1,session_id:null,tid:null},$simulationList:t("[data-"+a+'-parts="simulationList"]'),courseButtonID:"coursePulldownButton",userButtonID:"namePulldownButton",pwdButtonID:"loginButton",pwdObjClass:"elPassword",simulationListClass:"elSimulationList",sessionListClass:"elSessionList",trialListClass:"elTrialList",commentClass:"elComment",commentUserClass:"elUser",commentTimeClass:"elTimeStamp",coursePulldownID:null,userPulldownID:null,$coursePulldownBtn:null,$userPulldownBtn:null,$coursePulldownObj:null,$userPulldownObj:null,$pwdInputObj:null,$loginButtonObj:null,$commentArea:t("[data-"+a+'-parts="commentArea"]'),$loginInfo:t("[data-"+a+'-parts="loginInfo"]'),$username:t("[data-"+a+'-parts="username"]'),nextMethod:"course",courseLoaded:null,userLoaded:null,beforeAuth:null,authSuccess:null,authFail:null,userLogout:null,simulationLoaded:null,commentLoaded:null,idResult:null},n));var i=t(this),s=i.data(a);s.$coursePulldownBtn=i.find("#"+s.courseButtonID),s.courseButtonText=s.$coursePulldownBtn.text(),s.coursePulldownID=s.$coursePulldownBtn.attr("aria-controles"),s.$coursePulldownObj=i.find("#"+s.coursePulldownID),s.$userPulldownBtn=i.find("#"+s.userButtonID),s.userButtonText=s.$userPulldownBtn.text(),s.userPulldownID=s.$userPulldownBtn.attr("aria-controles"),s.$userPulldownObj=i.find("#"+s.userPulldownID),s.$pwdInputObj=i.find("."+s.pwdObjClass).find('input[type="password"]'),s.$loginButton=i.find("#"+s.pwdButtonID),e.courseLoader.apply(i),e.userLogout.apply(i)})},courseLoader:function(){var n=t(this),i=n.data(a);i.$coursePulldownBtn.on("click."+a,function(){i.$userPulldownBtn.text(i.userButtonText).parents("[aria-activedescendant]").attr("aria-activedescendant",""),i.$userPulldownObj.find("li").remove(),i.$userPulldownObj.attr("aria-expanded",!1),i.$pwdInputObj.attr("disabled","disabled").val(""),i.$loginButton.parents("[aria-activedescendant]").attr("aria-activedescendant",""),i.nextMethod="userLoader"}),t.ajax({type:"GET",url:i.courseURL,data:i.courseParameter}).done(function(a){var s={cid:[],cname:[]};t(a).find("CourseList").each(function(a){s.cid[a]=t(this).find("cid").text(),s.cname[a]=t(this).find("cname").text()});var d,o=s.cid.length,l=[];for(d=0;o>d;d++)l[d]=t("<li />").attr("data-cid",s.cid[d]);for(d=0;o>d;d++){var u=t('<a href="#" />').text(s.cname[d]);l[d].append(u)}for(d=0;o>d;d++)i.$coursePulldownObj.append(l[d]);i.$coursePulldownBtn.parents("[aria-activedescendant]").attr("aria-activedescendant",i.courseButtonID),i.nextMethod="userLoader",e.takeID.apply([n,l]),e.applyCallback.apply([n,"courseLoaded"])}).fail(function(){})},userLoader:function(){var n=t(this),i=n.data(a);i.$userPulldownBtn.on("click."+a,function(){i.$pwdInputObj.attr("disabled","disabled").val(""),i.$loginButton.parents("[aria-activedescendant]").attr("aria-activedescendant",""),i.nextMethod="authLogin"}),i.userParameter.cid=i.basicInfoObj.cid,t.ajax({type:"GET",url:i.userURL,data:i.userParameter}).done(function(a){var s={uid:[],uname:[]};t(a).find("UserList").each(function(a){s.uid[a]=t(this).find("uid").text(),s.uname[a]=t(this).find("username").text()});var d,o=s.uid.length,l=[];for(d=0;o>d;d++)l[d]=t("<li />").attr("data-uid",s.uid[d]).attr("data-uname",s.uname[d]);for(d=0;o>d;d++){var u=t('<a href="#" />').text(s.uname[d]);l[d].append(u)}for(d=0;o>d;d++)i.$userPulldownObj.append(l[d]);i.$userPulldownBtn.parents("[aria-activedescendant]").attr("aria-activedescendant",i.userButtonID),i.nextMethod="authLogin",e.takeID.apply([n,l]),e.applyCallback.apply([n,"userLoaded"])}).fail(function(){})},authLogin:function(){function i(a){a.preventDefault(),d.authParameter.pwd=d.$pwdInputObj.val(),t.ajax({type:"GET",url:d.authURL,data:d.authParameter}).done(function(a){var i=t(a).find("Auth").text();return"false"!=i?(e.applyCallback.apply([s,"authFail"]),d.$pwdInputObj.select(),!1):(d.$loginInfo.attr("aria-hidden",!1),d.$username.text(d.basicInfoObj.uname),n.data("educeboardBasicInfo",{uid:d.basicInfoObj.uid,uname:d.basicInfoObj.uname}),e.simulationLoader.apply(s),e.applyCallback.apply([s,"authSuccess"]),void 0)}).fail(function(){})}var s=t(this),d=s.data(a);e.applyCallback.apply([s,"beforeAuth"]),d.authParameter.uid=d.basicInfoObj.uid,d.$pwdInputObj.removeAttr("disabled").select(),d.$loginButton.parents("[aria-activedescendant]").attr("aria-activedescendant",d.pwdButtonID),d.$loginButton.off("."+a),d.$pwdInputObj.off("."+a),d.$loginButton.on("click."+a,i),d.$pwdInputObj.on("keypress."+a,function(t){13==t.which&&i(t)})},userLogout:function(){var n=t(this),i=n.data(a),s=i.$loginInfo,d=i.$username;n.on("click."+a,"[data-"+a+'-parts="logout"]',function(){t(this);s.attr("aria-hidden","true"),d.text(""),e.applyCallback.apply([n,"userLogout"])})},simulationLoader:function(){var n=t(this),i=n.data(a),s={cid:i.basicInfoObj.cid,uid:i.basicInfoObj.uid};t.ajax({type:"GET",url:i.simulationURL,data:s}).done(function(s){$listDom=i.$simulationList,$listDom.empty(),i.$pwdInputObj.val("");var d;t(s).find("simulation").each(function(s){d=t(this),simId=d.find("sim_id").text(),simName=d.find("sim_name").text(),$simLi=t("<li />").attr("data-listExpand-level",0).append(t("<dl />")),$sessionExpandWrap=t('<dd aria-expanded="false" id="expand'+s+'" />').append(t("<ul />",{"class":i.sessionListClass})),$simLi.find("dl").append(t('<dt><a href="#" role="button" aria-controles="expand'+s+'">'+simName+"</a></dt>")).append($sessionExpandWrap),d.find("session").each(function(d){var o=t(this),l=o.find("session_id").text(),u=o.find("session_name").text(),r=s+"-"+d,c=t("<li />").attr("data-listExpand-level",1).append(t("<dl />")),p=t('<dd aria-expanded="false" id="expand'+r+'" />').append(t("<ul />",{"class":i.trialListClass}));c.find("dl").append(t('<dt><a href="#" role="button" aria-controles="expand'+r+'">'+u+"</a></dt>")).append(p),$sessionExpandWrap.find("."+i.sessionListClass).append(c),o.find("trial").each(function(){var s=t(this),d=s.find("trial_id").text(),o=s.find("timestamp").text(),u=t('<li><p><a href="#" data-unitySyncData-parts="sendID" /></p></li>'),r=u.find("a");r.data("id",{simulationId:simId,sessionId:l,trialId:d}).text(o).on("click."+a,function(a){a.preventDefault();var s=t(a.target).data().id;i.basicInfoObj.sid=parseInt(s.sessionId),i.basicInfoObj.tid=parseInt(s.trialId),t("#educeboard").attr("aria-hidden",!1),t("#login").attr("aria-hidden",!0),e.commentLoader.apply(n),e.applyCallback.apply([n,"idResult"])}),p.find("."+i.trialListClass).append(u)})}),$listDom.append($simLi)}),e.applyCallback.apply([n,"simulationLoaded"])})},commentLoader:function(){var n=t(this),i=n.data(a),s=i.$commentArea;i.commentParameter.session_id=i.basicInfoObj.sid,i.commentParameter.tid=i.basicInfoObj.tid,t.ajax({type:"GET",url:i.commentURL,data:i.commentParameter}).done(function(a){var d,o,l,u,r,c,p={hour:0,minute:0,second:0,raw:""};t(a).find("Comments").each(function(a){d=t(this),c=t("<li />"),r=t("<dl />"),o=d.find("text").text(),l=d.find("username").text(),p.raw=parseInt(d.find("time").text()),p.second=p.raw,p.minute=parseInt(p.second/60),p.hour=parseInt(p.minute/60),p.minute=p.minute-60*p.hour,p.second=p.second-60*p.minute,u="";for(a in p)"raw"!=a&&(p[a]<10&&(p[a]="0"+p[a]),u+=p[a],"second"!=a&&(u+=":"));t("<dt />").text(o).toggleClass(i.commentClass,!0).appendTo(r),t("<dd />").text(l).toggleClass(i.commentUserClass,!0).appendTo(r),t("<dd />").text(u).toggleClass(i.commentTimeClass,!0).appendTo(r),c.attr("data-commentSyncScroll-timestamp",p.raw).append(r),s.append(c)}),e.applyCallback.apply([n,"commentLoaded"])}).fail(function(){})},takeID:function(){var n,i=t(this)[0],s=i.data(a),d=t(this)[1],o=d.length;for(n=0;o>n;n++)d[n].on("click."+a,function(a){a.preventDefault();var n=t(this),d=n.data();t.extend(s.basicInfoObj,d),e[s.nextMethod].apply(i)})},applyCallback:function(){var n=t(this)[0],e=n.data(a),i=t(this)[1];"function"==typeof e[i]&&e[i]()},destroy:function(){}};t.fn[a]=function(t){return e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void 0:e.initialize.apply(this,arguments)}}(jQuery);